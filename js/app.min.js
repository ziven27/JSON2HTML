$(function(){({reg:/<%=([^%>]+)?%>/g,goPageByIndex:function(t){$(".page").eq(t).addClass("_on").siblings("._on").removeClass("_on")},getDomByKeyVal:function(t,e){var n="<tr>";return n+='<td class="input-label">'+e+"</td>",n+='<td class="input-control">',"*"===t.charAt(3)?n+='<textarea required name="'+t+'" placeholder="'+e+'"></textarea>':n+='<input required type="text" name="'+t+'" placeholder="'+e+'" />',n+="</td><tr/>"},getTplDataByUserInput:function(){var t=$("#jsonForm").serializeArray();return this.serialize(t)},createInputByJsonTpl:function(t){var e=this;if(!t)return!1;var n=function(t){var a='<table class="m-input">';for(key in t){var r=t[key];"object"==typeof r?n(r):a+=e.getDomByKeyVal(key,r)}return a+="</table>"},a=n(t);$("#inputArea").append(a),this.goPageByIndex(1)},makeFileByString:function(t,e){saveAs(new Blob([t],{type:"text/plain;charset="+document.characterSet}),e||"index.html")},createOutput:function(t){var e=this;this.loadFileById("htmlTpl",function(n){var a=_.template(n)(t);e.makeFileByString(a)})},serialize:function(t){var e={};for(var n in t){var a=t[n];e[a.name.toString()]=a.value}return e},loadFileById:function(t,e){var n=document.getElementById(t).files[0],a=new FileReader;a.readAsText(n),a.onload=function(){e(this.result)}},getJsonTplByHtmlTpl:function(t){for(var e=this.reg,n={},a=!0;a=e.exec(t);)n[a[0]]=$.trim(a[1]);return n},html2Escape:function(t){return t.replace(/[<>&"]/g,function(t){return{"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;"}[t]})},getHtmlByData:function(t){for(var e=this,n=e.htmlTplFileString,a=e.reg,r=!0;r=a.exec(n);){var l=r[0],i=$.trim(t[l]);i&&(i=e.html2Escape(i),"*"===r[1].charAt(0)&&(i="<p>"+i.split("\n").join("</p><p>")+"</p>"),n=n.replace(l,i))}return n},renderInputByData:function(t){for(var e in t){var n=t[e];n&&""!=n&&$('[name="'+e+'"]').val(n)}},init:function(){var t=this;$("#htmlTpl").on("change",function(){t.loadFileById("htmlTpl",function(e){t.htmlTplFileString=e;var n=t.getJsonTplByHtmlTpl(e);t.createInputByJsonTpl(n)})}),$("#jsonForm").on("submit",function(e){e.preventDefault();var n=t.getTplDataByUserInput(),a=t.getHtmlByData(n);t.makeFileByString(a)}),$("#htmlPre").on("click",function(e){e.preventDefault();var n=t.getTplDataByUserInput(),a=t.getHtmlByData(n);$("#outArea").val(a),$("#htmlForm").removeClass("hide")}),$("#htmlForm").on("submit",function(e){e.preventDefault();var n=$("#outArea").val();t.makeFileByString(n)}),$("#downLoadDataTpl").on("click",function(e){e.preventDefault();var n=t.getTplDataByUserInput();t.makeFileByString(JSON.stringify(n),"data.json")}),$("#upLoadDataTpl").on("change",function(e){e.preventDefault(),t.loadFileById("upLoadDataTpl",function(e){var n=JSON.parse(e);t.renderInputByData(n)})})}}).init()});